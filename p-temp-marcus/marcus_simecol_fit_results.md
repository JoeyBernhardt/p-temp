# Fitting results

### Data

Here we read in the data used for all of the below plots:
```r
#file.path() is used for cross-platform compatibility
plotdata <- read.csv(file = file.path("p-temp-marcus", "outputs", "rawfitteddata05_2017_22_01.csv"),
	strip.white = TRUE,
	na.strings = c("NA","") )
```

### Code

The code used to generate the fits in seen below, as well as all related plotting functions, can be found at:
https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/p_temp_simecol_fit.R

### Plotting Simulated Density Curves vs. Observed Data

Here we show plots of the "best" three simulation results vs. the observed experimental data, for each treatment combination of phosphorus and temperature.

The goal here is to assess the quality of our model fits.

##### 12 Degrees, Phosphorus Deficient
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/def12plot.png" width="1000">
##### 12 Degrees, Phosphorus Rich
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/full12plot.png" width="1000">

##### 16 Degrees, Phosphorus Deficient
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/def16plot.png" width="1000">
##### 16 Degrees, Phosphorus Rich
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/full16plot.png" width="1000">

##### 20 Degrees, Phosphorus Deficient
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/def20plot.png" width="1000">
##### 20 Degrees, Phosphorus Rich
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/full20plot.png" width="1000">

##### 24 Degrees, Phosphorus Deficient
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/def24plot.png" width="1000">
##### 24 Degrees, Phosphorus Rich
<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/full24plot.png" width="1000">

The specific code used to generate the above plots can be found immediately below:
```r
plotbest3 <- function(phosphorus, temp) {

x <- paste(phosphorus, temp, sep = "")
obsdata <- ptempdata[[x]]

fitdata <- filter(rawfitteddata, treatment == x)

fitdata <- filter(fitdata, ssq != 0)
fitdata <- arrange(fitdata, ssq)
fitdata <- fitdata[1:3,] # use best 3 for now

fitdata$repnumber <- rownames(fitdata)
fitdata <- split(fitdata, f = fitdata$repnumber)

# objective is to write a function that operates on a single data frame of parameters and other info, and then produce the density estimates
# using the sim function in simecol. Then use map_df on this guy.

innerfunction <- function(xdata) {

fittedr <- xdata$r
fittedK <- xdata$K
fitteda <- xdata$a
fittedeps <- xdata$eps
fittedm <- xdata$m

SimParameters <- c(r = fittedr, K = fittedK, a = fitteda, eps = fittedeps, m = fittedm)

		dayzerodata <- filter(obsdata, days == 0)
		simmodel <- CRmodel
		init(simmodel) <- c(P = mean(dayzerodata$P), H = 10) # Set initial model conditions to the biovolume taken from the first measurement day
		parms(simmodel) <- SimParameters

		simdata <- out(sim(simmodel, rtol = 1e-10, atol = 1e-10))
		simdata <- mutate(simdata, repnumber = xdata$repnumber)

return(simdata)
}

best3simdata <- map_df(fitdata, innerfunction)

prod_plot <- ggplot() +
		geom_point(data = obsdata, aes(x = days, y = P)) +
		geom_line(data = best3simdata, aes(x = time, y = P, color = repnumber))


het_plot <- ggplot() +
		geom_point(data = obsdata, aes(x = days, y = H)) +
		geom_line(data = best3simdata, aes(x = time, y = H, color = repnumber))

output_plot <- grid.arrange(prod_plot, het_plot, ncol=2)

return(obsdata)

}
```


### Estimating Activation Energies for Fitted Parameter Values

The following plots were generated by plotting the fitted parameters from _all_ of the fitting attempts on each temperature/phosphorus treatment combination. More specifically, the fitting algorithm was run 100 times, using randomized start parameters, on each of the 8 treatments. I wanted to provide an idea of how our confidence intervals might change following resampling. It's important to note that these plots are not fully representative of the type of resampling we are going to do, but I still found them quite a bit more informative than simply plotting the parameters from our "best" fits.

Given the poor fits observed for some the treatments, particularly those for the 24 degree treatments, I think we can say with confidence that the parameter estimates are still incorrect.

<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/fittedr_2017_24_01.png" width="600">

<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/fittedK_2017_24_01.png" width="600">

<img src="https://github.com/JoeyBernhardt/p-temp/blob/master/p-temp-marcus/plots/fitteda_2017_24_01.png" width="600">
